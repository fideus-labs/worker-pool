<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>fizarrita worker pool benchmark</title>
  <link rel="icon" type="image/svg+xml" href="./fideus-logo.svg" />
  <link rel="stylesheet" href="./style.css" />
  <script src="coi-serviceworker.js"></script>
</head>
<body>
  <header>
    <div class="header-title">
      <a href="https://fideus.io" class="logo-link"><img src="./fideus-logo.svg" alt="Fideus" class="header-logo" /></a>
      <h1><a href="https://github.com/fideus-labs/worker-pool" class="title-link">fizarrita</a> worker pool benchmark</h1>
    </div>
    <p class="subtitle">Compare <code>getWorker</code>/<code>setWorker</code> vs vanilla zarrita <code>get</code>/<code>set</code></p>
  </header>

  <main>
    <!-- ================================================================= -->
    <!-- LEFT: Configuration Panel                                         -->
    <!-- ================================================================= -->
    <section class="config-panel" id="config-panel">
      <h2>Configuration</h2>

      <!-- Dataset source -->
      <fieldset>
        <legend>Dataset</legend>
        <div class="radio-group">
          <label><input type="radio" name="dataset-source" value="synthetic" /> Synthetic (in-memory)</label>
          <label><input type="radio" name="dataset-source" value="remote" checked /> Remote (OME-Zarr / S3)</label>
        </div>

        <!-- Synthetic options -->
        <div id="synthetic-options" class="sub-options hidden">
          <label>
            Shape
            <input type="text" id="syn-shape" value="288,288,288" placeholder="e.g. 288,288,288" />
          </label>
          <label>
            Chunk shape
            <input type="text" id="syn-chunks" value="96,96,96" placeholder="e.g. 96,96,96" />
          </label>
          <label>
            Data type
            <select id="syn-dtype">
              <option value="uint8">uint8</option>
              <option value="uint16">uint16</option>
              <option value="int32">int32</option>
              <option value="float32" selected>float32</option>
              <option value="float64">float64</option>
            </select>
          </label>
        </div>

        <!-- Remote options -->
        <div id="remote-options" class="sub-options">
          <label>
            Dataset
            <select id="remote-dataset">
              <option value="fuel">fuel (64^3, uint8, 2 chunks)</option>
              <option value="engine">engine (128x256x256, uint8, 16 chunks)</option>
              <option value="aneurism">aneurism (256^3, uint8, 32 chunks)</option>
              <option value="bonsai">bonsai (256^3, uint8, 32 chunks)</option>
              <option value="backpack" selected>backpack (512x512x373, uint16, 96 chunks)</option>
              <option value="bunny">bunny (512x512x361, uint16, 96 chunks)</option>
            </select>
          </label>
          <div id="remote-info" class="info-box"></div>
        </div>
      </fieldset>

      <!-- Pool size -->
      <fieldset>
        <legend>Worker Pool</legend>
        <label>
          Pool size
          <input type="number" id="pool-size" min="1" max="128" />
        </label>
        <div class="checkbox-group" style="margin-top: 10px">
          <label><input type="checkbox" id="opt-sab" checked /> Use SharedArrayBuffer</label>
          <label><input type="checkbox" id="opt-cache" /> Use Chunk Cache</label>
        </div>
        <p class="hint">SAB adds a "Worker + SAB" variant. Cache adds a "Worker + Cache" variant measuring pre-populated cache reads.</p>
      </fieldset>

      <!-- Iterations -->
      <fieldset>
        <legend>Iterations</legend>
        <label>
          Warmup runs
          <input type="number" id="warmup" value="2" min="0" max="20" />
        </label>
        <label>
          Benchmark iterations
          <input type="number" id="iterations" value="5" min="1" max="100" />
        </label>
      </fieldset>

      <!-- Operations -->
      <fieldset>
        <legend>Operations</legend>
        <div class="checkbox-group">
          <label><input type="checkbox" id="op-read" checked /> Read (get)</label>
          <label><input type="checkbox" id="op-write" disabled /> Write (set)</label>
        </div>
        <p class="hint">Write benchmarks only available for synthetic datasets.</p>
      </fieldset>

      <!-- Actions -->
      <div class="actions">
        <button id="btn-run" class="btn-primary">Run Benchmark</button>
        <button id="btn-cancel" class="btn-secondary" disabled>Cancel</button>
      </div>
    </section>

    <!-- ================================================================= -->
    <!-- RIGHT: Results Panel                                              -->
    <!-- ================================================================= -->
    <section class="results-panel" id="results-panel">
      <h2>Results</h2>

      <!-- Progress bar -->
      <div id="progress-container" class="progress-container hidden">
        <div class="progress-bar">
          <div id="progress-fill" class="progress-fill"></div>
        </div>
        <p id="progress-label" class="progress-label">Idle</p>
      </div>

      <!-- Chart -->
      <div id="chart-container" class="chart-container hidden">
        <canvas id="benchmark-chart"></canvas>
      </div>

      <!-- Results table -->
      <div id="table-container" class="table-container hidden">
        <table id="results-table">
          <thead id="results-head">
            <tr>
              <th>Operation</th>
              <th>Vanilla (ms)</th>
              <th>Worker (ms)</th>
              <th>Worker+SAB (ms)</th>
              <th>Speedup</th>
            </tr>
          </thead>
          <tbody id="results-body"></tbody>
        </table>
      </div>

      <!-- Per-iteration detail -->
      <div id="detail-container" class="detail-container hidden">
        <h3>Per-Iteration Timings</h3>
        <div id="detail-charts"></div>
      </div>

      <!-- Placeholder when no results -->
      <div id="no-results" class="no-results">
        <p>Configure and run a benchmark to see results here.</p>
      </div>
    </section>
  </main>

  <script type="module" src="./main.ts"></script>
</body>
</html>
